# AI 长期代理协议

一个用于AI代理在多个上下文窗口间工作的综合协议。灵感来源于Anthropic关于长期运行代理的有效约束研究。

## 解决的问题

AI代理在多个上下文窗口间工作面临两个关键失败模式：

1. **一次性做太多** - 留下半实现的功能和未记录的进度
2. **过早宣布完成** - 在未经验证的情况下宣布项目完成

## 解决方案

双代理方法：

| 代理 | 角色 |
|------|------|
| **初始化代理** | 搭建环境、创建功能列表、进行初始提交 |
| **编码代理** | 每次会话只处理一个功能，留下干净状态 |

## 快速入门

### 第一步：复制协议文件

将 `AGENT_PROTOCOL.md` 复制到你的项目目录。

### 第二步：发送提示词给AI

发送以下提示词给你的AI：

```
Read and follow the AGENT_PROTOCOL.md file for this project.
```

### 示例

假设你想让AI帮你开发一个聊天应用：

```
Read and follow the AGENT_PROTOCOL.md file for this project.

请帮我开发一个类似微信的聊天应用，支持：
- 用户注册登录
- 一对一聊天
- 群组聊天
- 发送图片和文件
```

### 接下来会发生什么

AI读取协议后：

1. **首次会话（初始化代理）**
   - AI检测到没有 `feature_list.json` 存在
   - 创建包含所有所需功能的完整功能列表
   - 创建 `claude-progress.txt` 用于进度追踪
   - 创建 `init.sh` 或 `init.bat` 用于运行项目
   - 进行初始git提交
   - 停止（不开始实现）

2. **后续会话（编码代理）**
   - AI读取进度文件和功能列表
   - 选择一个未完成的功能（最高优先级）
   - 实现并测试该功能
   - 以干净状态提交
   - 更新进度文件
   - 为下一会话做好准备

### 为什么有效

| 问题 | 解决方案 |
|------|----------|
| AI一次性做太多 | 协议强制每次会话只处理一个功能 |
| AI在会话间遗忘进度 | 进度文件提供上下文连续性 |
| AI过早宣布完成 | 功能列表追踪实际完成状态 |
| AI留下损坏的代码 | 提交前要求干净状态 |
| AI跳过测试 | 标记功能完成前必须进行端到端测试 |

## 核心组件

### feature_list.json

包含通过/失败状态的完整功能清单：
```json
{
  "features": [
    {
      "id": "F001",
      "category": "functional",
      "description": "功能描述",
      "steps": ["步骤1", "步骤2"],
      "priority": "high",
      "passes": false
    }
  ]
}
```

### claude-progress.txt

用于上下文连续性的会话进度日志。

### init.sh / init.bat

开发服务器启动脚本。

## 工作流程

```
会话开始
    ↓
pwd → 读取进度 → 读取功能列表 → git log → init.sh
    ↓
测试基础功能 → 修复bug
    ↓
选择一个功能（最高优先级，passes: false）
    ↓
实现 → 端到端测试验证
    ↓
提交（干净状态）→ 更新进度文件
    ↓
会话结束
```

## 核心规则

| 规则 | 说明 |
|------|------|
| 单一功能 | 每次会话只处理一个功能 |
| 干净状态 | 会话结束前代码必须能运行 |
| 端到端测试 | 需要实际测试，不仅仅是代码审查 |
| 记录进度 | 始终更新进度文件和git |
| 禁止删除 | 永远不要删除功能或修改测试步骤 |

## 文件说明

| 文件 | 说明 |
|------|------|
| `AGENT_PROTOCOL.md` | 核心协议文档 |
| `README.md` | 项目概述 |
| `LICENSE` | MIT许可证 |

## 许可证

MIT许可证 - 详见 [LICENSE](LICENSE) 文件。
