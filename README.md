# AI 长期代理协议

一个用于AI代理在多个上下文窗口间工作的综合协议。灵感来源于Anthropic关于长期运行代理的有效约束研究。

## 解决的问题

AI代理在多个上下文窗口间工作面临两个关键失败模式：

1. **一次性做太多** - 留下半实现的功能和未记录的进度
2. **过早宣布完成** - 在未经验证的情况下宣布项目完成

## 解决方案

双代理方法：

| 代理 | 角色 |
|------|------|
| **初始化代理** | 搭建环境、创建功能列表、进行初始提交 |
| **编码代理** | 每次会话只处理一个功能，留下干净状态 |

## 快速入门

### 使用方式

根据你的使用场景选择：

| 场景 | 说明 |
|------|------|
| **本地开发** | 有本地文件系统，AI可以读写文件 |
| **网页端** | 使用网页版AI，没有本地文件 |

---

### 本地开发用户
将AGENT_PROTOCOL.md拖给ai
#### 首次会话
```
发请阅读并遵循本项目的AGENT_PROTOCOL.md文件

项目如：请帮我开发一个购物网站，支持：
- 用户登录注册
- 商品浏览
- 购物车
- 订单支付
```

#### 后续新会话
```
发请阅读并遵循本项目的AGENT_PROTOCOL.md文件
```

AI会自动读取 `feature_list.json` 和 `claude-progress.txt`，继续工作。

---

### 网页/移动端用户

#### ⚠️ 重要提醒

**必须在 token 用完前提前触发生成总结！**

建议：当 token 使用超过 **70%** 时，立即发送触发词。，如果没显示使用了多少token那请您自行感觉

原因：
- Token 即将用尽时 AI 可能输出混乱
- 避免总结写到一半 token 就用尽

---

#### 触发词

发送以下任一触发词，AI 会自动生成交接总结：

| 触发词 | 说明 |
|--------|------|
| `会话总结` | 中文 |
| `交接` | 中文 |
| `summary` | 英文 |
| `handover` | 英文 |

---

═══════════════════════════════════════════════════════════════
                        项目交接总结
═══════════════════════════════════════════════════════════════

【工作目标】
项目名称：购物网站
项目描述：一个支持用户注册、商品浏览、购物车和订单支付的电商平台
技术栈：React + Node.js + MongoDB

【参考信息】
- 项目目录：/projects/shopping-site
- 启动命令：npm run dev
- 重要文件：src/App.js（主入口）、server/index.js（后端）

【已完成功能】
✅ F001: 用户注册页面

【待完成功能】
⬜ F002: 用户登录功能 - 优先级：high
⬜ F003: 商品列表页面 - 优先级：high
...

【当前状态】
- 最后完成的功能：F001 用户注册页面
- 代码状态：干净，可正常运行
- 已知问题：无

【下一步行动】
建议从 F002（用户登录功能）开始。

═══════════════════════════════════════════════════════════════
```

**→ 请复制保存这个总结！**

**新会话开始**：
```
Read and follow the AGENT_PROTOCOL.md file for this project.

[粘贴之前保存的交接总结]
```

AI 会继续工作。

---

### 工作流程示意

```
┌─────────────────────────────────────────────────────────────┐
│  会话 1：初始化代理                                          │
│  输入：协议 + 项目需求                                        │
│  输出：功能清单 + 交接总结                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  会话 2：编码代理                                            │
│  输入：协议 + 交接总结                                        │
│  输出：功能 F001 完成 + 新的交接总结                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  会话 3：编码代理                                            │
│  输入：协议 + 交接总结                                        │
│  输出：功能 F002 完成 + 新的交接总结                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
                           ... ...
```

---

## 交接总结说明

交接总结包含以下信息：

| 字段 | 说明 |
|------|------|
| 工作目标 | 项目要做什么，使用什么技术 |
| 参考信息 | 如何启动项目，关键文件在哪 |
| 已完成功能 | 哪些功能已经做好了 |
| 待完成功能 | 哪些功能还没做，优先级如何 |
| 当前状态 | 最后做了什么，代码是否有问题 |
| 下一步行动 | 建议从哪个功能继续 |

---

## 核心规则

| 规则 | 说明 |
|------|------|
| 单一功能 | 每次会话只处理一个功能 |
| 干净状态 | 会话结束前代码必须能运行 |
| 端到端测试 | 需要实际测试，不仅仅是代码审查 |
| 记录进度 | 始终更新进度或生成交接总结 |
| 禁止删除 | 永远不要删除功能或修改测试步骤 |

## 文件说明

| 文件 | 说明 |
|------|------|
| `AGENT_PROTOCOL.md` | 核心协议文档 |
| `README.md` | 项目概述 |
| `LICENSE` | MIT许可证 |

## 许可证

MIT许可证 - 详见 [LICENSE](LICENSE) 文件。
